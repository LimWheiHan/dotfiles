#+STARTUP: overview
#+TITLE: Emacs Settings
#+CREATOR: Lim Whei Han
#+LANGUAGE: en
#+OPTIONS: num:nil
#+ATTR_HTML: :style margin-left: auto; margin-right: auto;
#+STARTUP: noindent
[[./img/screen.png]]

* References
- Dawid 'daedreth' Eckert
** Planned Improvements
References to sample:
- https://github.com/SophieBosio/.emacs.d
** General Conventions
try studying https://sophiebos.io/posts/first-emacs-config/

*** Booleans

Variables  1 | 0
Modes t | nil
*** Key Bindings
** Key Map Plan
#+begin_center
C-x
   :p
   Project
   :g
   Magit
#+end_center
* Installation

** Quick Installation
=git clone https://github.com/daedreth/UncleDavesEmacs ~/.emacs.d=

* Dependencies
In Global Environment
** Python
- jedi: autocomplete
- flake8: pyproject.toml config
- autopep8: format code to PEP 8 style
  (can maybe switch to *black* or *ruff*)
- virtualenv / uv
  - use pyvenv, trigger with pyvenv-activate: args with the venv dir
#+begin_src sh
  # pip install jedi flake8 autopep8
#+end_src
** C
- clang
** elisp files

- dired-icon.el
- rainbow-csv.el
- graphviz-dot-mode.el

* Icons, Fonts & Themes
** icons

Font need to manually installed after these packages loaded using *M-x all-the-icons-install-fonts*
#+begin_src emacs-lisp
;; Icons
(use-package all-the-icons
  :ensure t
  :init)

(add-to-list 'load-path "~/.emacs.d/custom-packages/")
(load "dired-icon.el")
(add-hook 'dired-mode-hook 'dired-icon-mode)

(use-package all-the-icons-dired
  :ensure t
  :init (add-hook 'dired-mode-hook 'all-the-icons-dired-mode)
  ;; for some reason the icons by default are monochrome
  :config (setq all-the-icons-dired-monochrome nil))

(use-package all-the-icons-ibuffer
  :ensure t
  :init (all-the-icons-ibuffer-mode 1))

;; Themes
;; (use-package zenburn-theme
;;   :config
;;   (load-theme 'zenburn t))

(use-package doom-themes
  :config
  (load-theme 'doom-one t))

;; (use-package ef-themes
;;   :if window-system
;;   :ensure t
;;   :config
;;   ;; Enable the theme
;;   (load-theme 'ef-dark  t))


;; ref :; https://github.com/nordtheme/emacs
(add-to-list 'custom-theme-load-path (expand-file-name "~/.emacs.d/themes/"))
;; (use-package nord-theme
;;   :config
;;   (load-theme 'nord t))





;; (mode-icons-mode)
#+end_src


** Fonts
#+begin_src emacs-lisp
  ;; Default Fonts
;; (add-to-list 'default-frame-alist
;; 	     '(font . "FiraCode Nerd Font-12"))
(add-to-list 'default-frame-alist
	       '(font . "JetBrains Mono-12"))

#+end_src
* Shell
In Linux use bash as the shell in eshell?
#+begin_src emacs-lisp
  ;; define default shell to use (LINUX ONLY)
    ;; (defvar my-term-shell "/bin/bash")
    ;; (defadvice ansi-term (befire force-bash)
    ;;   (interactive (list my-term-shell)))
    ;; (ad-activate 'ansi-term)
    ;; (global-set-key (kbd "<s-return>") 'ansi-term)

#+end_src
** vterm
Only for Linux
#+begin_src emacs-lisp
;; This command will Compile the C program vterm ensure prereq OS packages: Install cmake, libtool, and libtool-bin
(use-package vterm
    :ensure t)
#+end_src
* Improved Basic Interface

** Searching
Navigate using up & down, RET to go to instance
#+begin_src emacs-lisp
  ;; Search and show instances
(use-package swiper
  :ensure t
  ; :bind ("C-s" . swiper)
  :config (global-set-key (kbd "C-S-s") 'swiper))
#+end_src

** Multicursors
Currently using Multi-cursor, _mark-multiple_ is another option
#+begin_src emacs-lisp
  ; https://github.com/magnars/multiple-cursors.el
  (use-package multiple-cursors
    :ensure t
    ;; make mc mode Enter no do anything so can add newline 
    :bind (:map mc/keymap ("<return>" . nil)))

  ;(global-unset-key (kbd "M-<down-mouse-1>"))
  ;(global-set-key (kbd "M-<mouse-1>") 'mc/add-cursor-on-click)
  (global-set-key (kbd "C-S-l") 'mc/mark-all-like-this)
  (global-set-key (kbd "C-S-<mouse-1>") 'mc/add-cursor-on-click)
  ;; Mark First Then add cursors
  (global-set-key (kbd "C-S-c C-S-c") 'mc/edit-lines)
  (global-set-key (kbd "C-M-<down>") 'mc/mmlte--down)
  ;; (global-set-key (kbd "C-M-<up>") 'mc/mmlte--up)
  (global-set-key (kbd "C-M-<up>") 'duplicate-dwim)
#+end_src

** Move-Text
#+begin_src emacs-lisp
(use-package move-text
  :ensure t)
(move-text-default-bindings)
;; This sets the keyboard shortcuts:
;;     Meta-up move-text-up (line or active region)
;;     Meta-down move-text-down (line or active region)
#+end_src
** COMMENT Linting
Flycheck is the more modern, but flymake is built-in
#+begin_src emacs-lisp
  ; Global Linting
(use-package flycheck
  :ensure t
  :init
  (global-flycheck-mode t))
#+end_src

** Formatter
#+begin_src emacs-lisp
  ;; Formatter
  (use-package format-all
    :ensure t)
  ;; Run format-all to format buffer

#+end_src
** Tabs
#+begin_src emacs-lisp
(use-package project-tab-groups
  :ensure t
  :config
  (project-tab-groups-mode t))

;; Tabs Prefix C-x t
;; (global-set-key (kbd "C-x <next>") 'tab-next)
;; (global-set-key (kbd "C-x <prior>") 'tab-previous)
;; Just use the default
;; (global-set-key (kbd "C-<tab>") 'tab-next)
;; (global-set-key (kbd "C-S<tab>") 'tab-previous)

(setq tab-bar-show t) ;; Enable Tabs
(global-set-key (kbd "C-x t") #'tab-new)
(global-set-key (kbd "C-x q") #'tab-close)
;; C-Tab: Switch between tabs

#+end_src
** Treemacs
#+begin_src emacs-lisp
(use-package treemacs
  :ensure t
  :bind
  (("C-c t" . treemacs))
  :config
  ;; Treemacs become invisible to other-windows command
  (setq treemacs-is-never-other-window t)
  (setq treemacs-width 30)
  (display-line-numbers nil)
  (setq-local mode-line-format nil))

#+end_src
** Tree-Sitter
Can explore code syntax tree

*** Treesitter Grammars Source

#+begin_src emacs-lisp
(setq treesit-language-source-alist
   '((bash "https://github.com/tree-sitter/tree-sitter-bash")
     (cmake "https://github.com/uyha/tree-sitter-cmake")
     (css "https://github.com/tree-sitter/tree-sitter-css")
     (elisp "https://github.com/Wilfred/tree-sitter-elisp")
     (go "https://github.com/tree-sitter/tree-sitter-go")
     (html "https://github.com/tree-sitter/tree-sitter-html")
     (javascript "https://github.com/tree-sitter/tree-sitter-javascript" "master" "src")
     (json "https://github.com/tree-sitter/tree-sitter-json")
     (make "https://github.com/alemuller/tree-sitter-make")
     (markdown "https://github.com/ikatyang/tree-sitter-markdown")
     ;; (python . ("https://github.com/tree-sitter/tree-sitter-python" "v0.23.6" nil nil nil))
     (python . ("https://github.com/tree-sitter/tree-sitter-python" "v0.23.6" "src"))
     ;; (python "https://github.com/tree-sitter/tree-sitter-python")
     (toml "https://github.com/tree-sitter/tree-sitter-toml")
     (tsx "https://github.com/tree-sitter/tree-sitter-typescript" "master" "tsx/src")
     (typescript "https://github.com/tree-sitter/tree-sitter-typescript" "master" "typescript/src")
     (yaml "https://github.com/ikatyang/tree-sitter-yaml")))
#+end_src
*** Syntax Highlighting
M-x `treesit-explre-mode`, `treesit-inspect-mode`
#+begin_src emacs-lisp
;; TreeSitter
(use-package tree-sitter
  :ensure nil
  :when (treesit-available-p)
  :init
  (setq treesit-font-lock-level 4)
  ;; Remap Langs Major Mode to their TS version
  (setq major-mode-remap-alist
        '((yaml-mode . yaml-ts-mode)
	      (bash-mode . bash-ts-mode)
	      (js2-mode . js-ts-mode)
	      (json-mode . json-ts-mode)
	      (css-mode . css-ts-mode)
	      (c-mode . c-ts-mode)
	      (c++-mode . c++-ts-mode)
	      (python-mode . python-ts-mode))))

;; ref: https://www.reddit.com/r/emacs/comments/151fplj/how_to_correctly_enable_treesitterhlmode_with/
(use-package tree-sitter-langs
  :after tree-sitter
  :config
  ;; Shorted list creation macro doesn't work without the `setq`???
  (setq major-mode-remap-alist
        '((yaml-mode . yaml-ts-mode)
          (bash-mode . bash-ts-mode)
          (js2-mode . js-ts-mode)
          (json-mode . json-ts-mode)
          (css-mode . css-ts-mode)
          (c-mode . c-ts-mode)
          (c++-mode . c++-ts-mode)
          (python-mode . python-ts-mode)))
  ;; (add-to-list 'major-mode-remap-alist '(c-mode . c-ts-mode))
  ;; (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode))

  (setq tree-sitter-major-mode-language-alist 
               '((c++-ts-mode . cpp)
               (c-ts-mode . c)
               (yaml-ts-mode . yaml)
               (python-ts-mode . python)))
  ;; (add-to-list 'tree-sitter-major-mode-language-alist '(c++-ts-mode . cpp))
  ;; (add-to-list 'tree-sitter-major-mode-language-alist '(c-ts-mode . c))
  )

(use-package treesit-auto
  :after tree-sitter
  :config
  ;; (treesit-auto-install-all)
  ;; (global-tree-sitter-mode)
  (treesit-auto-add-to-auto-mode-alist 'all))


;; Syntax Highlighting not working
;; (global-tree-sitter-mode)
(add-hook 'tree-sitter-after-on-hook #'tree-sitter-hl-mode)
;; (add-hook 'python-mode-hook #'tree-sitter-hl-mode)
#+end_src

** Project Mode
#+begin_src emacs-lisp
  ;; Projectile Mode (Not working?)
(use-package projectile
  :ensure t
  :init
  ;; automatic project discovery
  (setq projectile-project-search-path '("~/projects/" "~/work/" "~/dotfile"))
  ;; else manual discover in M-x projectile-discover-projects-in-directory.
  :defer t
  :config
  (add-to-list 'load-path "/path/to/projectile/directory")
  ;; Enable Projectile globally
  (setq projectile-completion-system 'ido)
  (setq ido-enable-flex-matching t)
  ;; risky if using local file directories???
  ;; (define-key projectile-mode-map (kbd "C-x p") 'Projectile-command-map)
  (projectile-mode 1)
  :bind (:map projectile-mode-map
              ;; ("s-p" . projectile-command-map)
              ("C-c p" . projectile-command-map)))
#+end_src

** COMMENT (Moved to init.el) Improved Garbage Collection
Dial the GC threshold back down so that garbage collection happens more frequently but in less time.


ref: github.com/doomemacs/doomemacs/issues/3108
#+begin_src emacs-lisp
;; FROM EMACS FROM SCRATCH
;; Make gc pauses faster by decreasing the threshold.
;; (setq gc-cons-threshold (* 2 1000 1000))

;; FROM UNCLE DAVE
;;; This fixed garbage collection, makes emacs start up faster ;;;;;;;
(setq gc-cons-threshold 402653184
      gc-cons-percentage 0.6)

(defvar startup/file-name-handler-alist file-name-handler-alist)
(setq file-name-handler-alist nil)

(defun startup/revert-file-name-handler-alist ()
  (setq file-name-handler-alist startup/file-name-handler-alist))

(defun startup/reset-gc ()
  (setq gc-cons-threshold 16777216
	gc-cons-percentage 0.1))

(add-hook 'emacs-startup-hook 'startup/revert-file-name-handler-alist)
(add-hook 'emacs-startup-hook 'startup/reset-gc)

;; Automatically Done in Doom?
;; ref: github.com/doomemacs/doomemacs/issues/3108
;; (after! gcmh
;;   (setq gc-cons-threshold  33554432
;;       gc-cons-percentage 0.6))  ; 32mb, or 64mb, or *maybe* 128mb, BUT NOT 512mb
#+end_src


** General Preferences
#+begin_src emacs-lisp
(put 'upcase-region 'disabled nil)
(setq inhibit-startup-screen t
					;initial-scratch-message ""
      )

;; Initial Mode for Scratch Buffer
(setq initial-major-mode 'org-mode)

(tool-bar-mode 0)
(menu-bar-mode 0)
(scroll-bar-mode 0)
(whitespace-mode 0)  ;; disable by default
(setq whitespace-line-column 160) ;; Set the limit for long lines
;; Make sure 'lines' or 'lines-tail' is included in whitespace-style for this to work
(setq whitespace-style '(face tabs empty trailing lines-tail))

(global-display-line-numbers-mode 0)
;;(global-display-line-numbers-mode 1)
;; Only Display Line Numbers in Programming Language Modes
;;(add-hook 'prog-mode '(lambda () (display-line-numbers t)))
(add-hook 'prog-mode 'display-line-numbers-mode)
;; ref: https://emacs.stackexchange.com/questions/30221/wrap-lines-at-80-characters
(setq-default fill-column 160) ;; word line length increased from default 70
;; (setq display-line-numbers-type 'relative)
(ido-mode t)
(ido-everywhere t)
(setq ido-enable-flex-matching t)
(setq ido-create-new-buffer 'always)

;; show all whitespaces
;; (global-whitespace-mode nil)
;; (global-whitespace-newline-mode nil)


;; (delete-selection-mode   t) ;; Replace selected text when yanking
(global-so-long-mode     t) ;; Mitigate performance for long lines
;; (global-visual-line-mode t) ;; Break lines instead of truncating them
(global-auto-revert-mode t) ;; Revert buffers automatically when they change
(recentf-mode            t) ;; Remember recently opened files
(savehist-mode           t) ;; Remember minibuffer prompt history
(save-place-mode         t) ;; Remember last cursor location in file

;; Save & Restore Previous Sessions
(desktop-save-mode 1)

;; In case of accidental close
(setq confirm-kill-emacs 'y-or-n-p)

;; Instead of M-x list-buffer from C-x C-b
;; make ibuffer default
;; (global-set-key (kbd "C-x C-b") 'ibuffer)
(defalias 'list-buffers 'ibuffer)
;; (setq ibuffer-expert t)    ; assume u an expert, won't ask confirmation
;; don't follow to the dotfiles directory
(setq vc-follow-symlinks nil)
(electric-pair-mode t) ; For auto-closing brackets

;; make electric-pair-mode work on more brackets ONLY ON MARKED REGION
(defun my/only-if-use-region (func &rest args)
  ;; "Only call the original function FUNC if the region is active."
  ;;  Otherwise, do nothing and let the standard character insertion proceed
  ;; (which means only the single character is inserted, not the pair)
  (if (use-region-p)
      (apply func args)))
(advice-add 'electric-pair-post-self-insert-function :around 'my/only-if-use-region)
;; (setq electric-pair-pairs ) ;; this is applied to ALL MODES, overrides programming modes
;; (setq electric-pair-text-pairs
(setq electric-pair-pairs
      '(
        (?\/ . ?\/)
        (?\\ . ?\\)
        (?\` . ?\`)
        (?\' . ?\')
        (?\~ . ?\~)
        (?\_ . ?\_)
        (?\* . ?\*)
        (?\{ . ?\})))

(fset 'yes-or-no-p 'y-or-n-p)  ;; change to y or n instead of yes no
;; (defaluas 'yes-or-no-p 'y-or-n-p)


(setq scroll-conservatively 100)
(setq ring-bell-function 'ignore)

;; Init Shine Cursor
(use-package beacon
  :ensure t
  :init
  (beacon-mode 1))

;; Async where can, currently only Dired
(use-package async
  :ensure t
  :init (dired-async-mode t))

;; maximise screen on startup
(add-hook 'window-setup-hook 'toggle-frame-maximized t)

;; (setq make-backup-files nil) 		; stop creating backup files
;; Write backups here
(setq backup-directory-alist '(("." . "~/.emacs.d/backups")))


(setq auto-save-default nil)	;; stop creating autosave files


;; (setq shift-select-mode t)	;; use shift to highlight region
;; delete marked region, disabled better to be explicit
;; (delete-selection-mode t)
#+end_src
*** Zooming
Text Size Adjust
#+begin_src emacs-lisp
  (global-set-key (kbd "C-+") 'text-scale-increase)
  (global-set-key (kbd "C--") 'text-scale-decrease)
  (global-set-key (kbd "<C-wheel-up>") 'text-scale-increase)
  (global-set-key (kbd "<C-wheel-down>") 'text-scale-decrease)
#+end_src
*** COMMENT qWindow Resize
#+begin_src emacs-lisp
  (global-set-key (kbd "<C-up>") 'shrink-window)
  (global-set-key (kbd "<C-down>") 'enlarge-window)
  (global-set-key (kbd "<C-left>") 'shrink-window-horizontally)
  (global-set-key (kbd "<C-right>") 'enlarge-window-horizontally)
#+end_src
*** COMMENT Windows Navigate
Using WindMove (built-in emacs)
#+begin_src emacs-lisp
  ;; activate
  (when (fboundp 'windmove-default-keybindings)
    (windmove-default-keybindings))

  (defun ignore-error-wrapper (fn)
    "Funtion return new function that ignore errors.
     The function wraps a function with `ignore-errors' macro."
    (lexical-let ((fn fn))
      (lambda ()
        (interactive)
        (ignore-errors
           (funcall fn)))))

  ;; (global-set-key [s-left] (ignore-error-wrapper 'windmove-left))
  ;; (global-set-key [s-right] (ignore-error-wrapper 'windmove-right))
  ;; (global-set-key [s-up] (ignore-error-wrapper 'windmove-up))
  ;; (global-set-key [s-down] (ignore-error-wrapper 'windmove-down))

#+end_src
*** Ace Window
#+begin_src emacs-lisp
;; smart window changing
(use-package ace-window
  :ensure t)

;; enable ace-window for fast window switching 
(global-set-key (kbd "M-o") 'ace-window)
(global-set-key (kbd "C-x w") 'ace-swap-window)
(global-set-key (kbd "C-x C-w") 'ace-select-window)

;; if 1+ window, use number to select window
#+end_src
*** COMMENT Frame Navigate
Integrate with WindMove to navigate thru Frames
#+begin_src emacs-lisp
  (windmove-default-keybindings)
  (setq framemove-hook-into-windmove t)
#+end_src
** which-key
  Which-key is a program to display what keys are next on your minibuffer
#+begin_src emacs-lisp
  ;; Suggestions for emacs keys
  ;; (use-package which-key
  ;;   :ensure t
  ;;   :init
  ;;   (which-key-mode))

  (use-package which-key
    :ensure t
    ;;  :straight t
    :init
    (which-key-mode t)
    :config
    (setq which-key-side-window-location 'bottom
  	which-key-sort-order #'which-key-key-order
  	which-key-allow-imprecise-window-fit nil
  	which-key-sort-uppercase-first nil
  	which-key-add-column-padding 1
  	which-key-max-display-columns nil
  	which-key-min-display-lines 6
  	which-key-side-window-slot -10
  	which-key-side-window-max-height 0.25
  	which-key-idle-delay 0.8
  	which-key-max-description-length 25
  	which-key-allow-imprecise-window-fit nil
  	which-key-separator " ? " ))
#+end_src
** Multiple Scratch Buffers
M-x scratch to open a new scratch buffer
#+begin_src emacs-lisp
(use-package scratch
  :ensure t
  )
#+end_src
** Vertico
Vertico provides a performant and minimalistic vertical completion UI based on the default completion system
shows options in M-x, no need helm from doom or ivy from spacemacs
#+begin_src emacs-lisp
(use-package vertico
  :ensure t
  :init
  (vertico-mode)

  ;; Different scroll margin
  ;; (setq vertico-scroll-margin 0)

  ;; Show more candidates
  (setq vertico-count 20)

  ;; Grow and shrink the Vertico minibuffer
  (setq vertico-resize t)

  ;; Optionally enable cycling for `vertico-next' and `vertico-previous'.
  (setq vertico-cycle t))
#+end_src

*** Completion Frameworks
Latest is Vertico (and its friends, consult.el ).Ivy from Spacemacs & Helm from Doomemacs

ref: https://erick.navarro.io/blog/switching-from-helm-to-vertico-and-friends/
    vertico: UI for completion, based on minibuffer, it also has a option to use a separate buffer, just like helm
    marginalia: Enhance the minibuffer with more context about the information shown
    orderless: completion style, add fuzzy search to filter between the data shown by vertico
    consult: commands for search and navigation
    embark: runs commands given a context at point

*** Marginalia
This package provides marginalia-mode which adds marginalia to the minibuffer completions.
#+begin_src emacs-lisp
(use-package marginalia
  :ensure t
  ;; Bind `marginalia-cycle' locally in the minibuffer.  To make the binding
  ;; available in the *Completions* buffer, add it to the
  ;; `completion-list-mode-map'.
  :bind (:map minibuffer-local-map
         ("M-A" . marginalia-cycle))

  ;; The :init section is always executed.
  :init

  ;; Marginalia must be actived in the :init section of use-package such that
  ;; the mode gets enabled right away. Note that this forces loading the
  ;; package.
  (marginalia-mode))
#+end_src

*** Orderless
#+begin_src emacs-lisp
(use-package orderless
  :ensure t
  :custom
  (completion-styles '(orderless basic))
  (completion-category-overrides '((file (styles basic partial-completion)))))
#+end_src

** Colored Indents & Brackets
#+begin_src emacs-lisp
(use-package indent-guide
  :defer t
  ;;:straight t
  :ensure t
  :hook
  (prog-mode . indent-guide-mode)  ;; Activate indent-guide in programming modes.
  :config
  (setq indent-guide-char "|"))    ;; Set the character used for the indent guide.

;; Highligth Indent
(use-package highlight-indent-guides
  :ensure t
  :defer t
  :hook (prog-mode . highlight-indent-guides-mode)
  :config
  (setq highlight-indent-guides-method 'fill)
  ;; (setq highlight-indent-guides-character ?\|)
  (set-face-background 'highlight-indent-guides-odd-face "darkgray")
  (set-face-background 'highlight-indent-guides-even-face "dimgray")
  ;; (set-face-background 'highlight-indentation-face "#e3e3d3")
  ;; (set-face-background 'highlight-indentation-current-column-face "#c3b3b3")
  ;; (set-face-foreground 'highlight-indent-guides-character-face "dimgray")
  (setq highlight-indent-guides-responsive 'top))


;; (setq highlight-indentation-blank-lines t)
;; Color Brackets
(use-package rainbow-delimiters
  :ensure t
  :init
  (rainbow-delimiters-mode 1))
(add-hook 'prog-mode-hook #'rainbow-delimiters-mode)

(show-paren-mode t)

;; Highlight brackets if visible else entire expression ;; combines 'parenthesis & 'expression
(setq show-paren-style 'mixed)


;; Windows Mode Only Features
(when window-system
  (global-hl-line-mode t)		; global highlight line mode 
  ;; (global-prettify-symbols-mode t) 	; for icons like lambda & nill
  )

;; Make 4 SPC indent the default
(setq-default indent-tabs-mode nil)     ; replace instead of tabs for indent
(setq-default tab-width 4)
(setq indent-line-function 'insert-tab)
#+end_src
** Wrap-Region Mode
ref: github.com/rejeep/wrap-region.el

#+begin_src emacs-lisp
(use-package wrap-region
  :ensure t
  :config
  (wrap-region-add-wrappers
  '(("$" "$")
    ("*" "*")
    ("~" "~")
    ("_" "_")
    ("{-" "-}" "#")
    ("/" "/" nil ruby-mode)
    ("/* " " */" "#" (java-mode javascript-mode css-mode))
    ("`" "`" nil (markdown-mode ruby-mode)))))
#+end_src
** Show Hex Colors
#+begin_src emacs-lisp
  ;; Show HEX COLORS
  (use-package rainbow-mode
    :ensure t
    :init (add-hook 'prog-mode-hook 'rainbow-mode))

#+end_src
** Folding
#+begin_src emacs-lisp
(use-package fold-this
  :ensure t
  :config
  ;; (global-set-key (kbd "C-c C-f") 'fold-this-all)
  ;; (global-set-key (kbd "C-c C-F") 'fold-this)
  ;; (global-set-key (kbd "C-c M-f") 'fold-this-unfold-all)
  (global-set-key (kbd "C-{") 'fold-this-all)
  (global-set-key (kbd "C-}") 'fold-this-unfold-all))
  ;;(global-set-key (kbd "C-}") 'fold-this-unfold-at-point))


#+end_src
** Chinese Input
ref: http://www.xahlee.info/emacs/emacs/emacs_chinese_input.html
1. (M-x set-input-method RET chinese-py)
2. To return back normal input, (M-x toggle-input-method @ C-\)
* Perspective ?
Like tiling manager? Need research
#+begin_src emacs-lisp
  (use-package perspective
    :ensure t)
#+end_src
* Programming
** LSP-Servers
*** General Settings
#+begin_src emacs-lisp
(add-hook 'prog-mode-hook #'display-line-numbers-mode)
#+end_src
*** COMMENT Eglot
Try using eglot,since more minimal
#+begin_src emacs-lisp
;; (use-package eglot
;;   ;; :ensure t
;;   :defer t
;;   :bind (:map eglot-mode-map
;; 	      ("C-c C-d" . eldoc)
;; 	      ;; ("C-c C-f" . eglot-format)
;; 	      ("C-c C-r" . eglot-rename)
;; 	      ("C-c C-a" . eglot-code-action)
;; 	      ("C-c C-o" . python-sort-imports)
;; 	      ("C-c C-f" . eglot-format-buffer))
;;   :hook
;;   ((python-mode . eglot-ensure)
;;    (rust-mode . eglot-ensure)
;;    (c++-mode . eglot-ensure)
;;    (c++-ts-mode . eglot-ensure)
;;    (c-mode . eglot-ensure)
;;    (c-ts-mode . eglot-ensure)
;;    (go-mode . eglot-ensure))
  ;; :config
  ;; (add-to-list 'eglot-server-programs
  ;; 	        '((c++-mode c-mode) "clangd")
  ;; 		'((​rust-mode​) ​.​ (​"​rust-analyzer​"​))
  ;;               '(python-mode . (eglot-alternatives (
  ;; 					("pyright-langserver" "--stdio")
  ;;                                         "jedi-language-server"
  ;;                                         "pylsp")))))

;; (with-eval-after-load 'eglot
;;   (add-to-list 'eglot-server-programs 
;; 	       '((c++-mode c++-ts-mode c-mode c-ts-mode) . "clangd")
;; 	       '(rust-mode​ ​.​ "​rust-analyzer​"​)
;;                '((python-mode python-ts-mode) . (eglot-alternatives (
;; 								     "pylsp"    
;; 								     ("pyright-langserver" "--stdio")
;; 								     "jedi-language-server"
;; 								     )))
;; 	       '(markdown-mode . ("marksman"))
;; 	       ))


;; (add-hook 'c-mode-hook #'eglot-ensure)
;; (add-hook 'c-ts-mode-hook #'eglot-ensure)
;; (add-hook 'c++-mode-hook #'eglot-ensure)
;; (add-hook 'c++-ts-mode-hook #'eglot-ensure)

(use-package eldoc
  :after t
  :config
  (global-eldoc-mode))

;; (add-to-list 'load-path "~/.emacs.d/")
;; (load "org-eldoc.el")
;; (add-hook 'org-mode-hook #'org-eldoc-load)
;; (add-hook 'eldoc-documentation-functions #'org-eldoc-documentation-function)

(use-package eldoc-box
  :after eglot
  :config
  (add-hook 'eglot-managed-mode-hook #'eldoc-box-hover-mode t))
;;  (add-hook 'eglot-managed-mode-hook #'eldoc-box-eglot-help-at-point t))


#+end_src
*** COMMENT LSP-Mode
use LSP-Mode, more mature than eglot?
ref: https://systemcrafters.net/emacs-from-scratch/build-your-own-ide-with-lsp-mode/

can install lsp from emacs *M-x lsp-install-server*
#+begin_src emacs-lisp
;; (use-package lsp-mode
;;   :ensure t
;;   :commands (lsp lsp-deferred)
;;   :hook ;;((python-mode rust-mode) . lsp-deferred)
;;   (python-mode . lsp)
;;   (rust-mode . lsp)
;;   (lsp-mode . lsp-enable-which-key-integration)
;;   :demand t
;;   :init
;;   (setq lsp-auto-guess-root nil)
;;   (setq lsp-keymap-prefix "C-c l")
;;   ;; TODO: https://emacs-lsp.github.io/lsp-mode/page/performance/
;;   ;; also note re "native compilation": <+varemara> it's the
;;   ;; difference between lsp-mode being usable or not, for me
;;   :config
;;   (setq lsp-auto-configure t))

;; (use-package lsp-mode
;;   :init
;;   (setq lsp-auto-guess-root nil)
;;   :hook (python-mode . lsp)
;;   (rust-mode . lsp)
;;   (lsp-mode . lsp-enable-which-key-integration)
;;   :commands lsp)

;; (use-package lsp-ui
;;   :ensure t
;;   :config
;;   (setq lsp-ui-flycheck-enable t)
;;   (add-to-list 'lsp-ui-doc-frame-parameters '(no-accept-focus . t))
;;   (define-key lsp-ui-mode-map [remap xref-find-definitions] #'lsp-ui-peek-find-definitions)
;;   (define-key lsp-ui-mode-map [remap xref-find-references] #'lsp-ui-peek-find-references)
;;   :commands lsp-ui-mode)
#+end_src
**** COMMENT LSP-Treemacs
#+begin_src emacs-lisp
;; (use-package lsp-treemacs
;;   :ensure t
;;   :after lsp
;;   :commands lsp-treemacs-errors-list)
#+end_src
** Auto Complete
*** Corfu
Completion in Region Function

#+begin_src emacs-lisp
(use-package corfu
  ;; Optional customizations
  :custom
  (corfu-cycle t)                ;; Enable cycling for `corfu-next/previous'
  (corfu-quit-at-boundary nil)   ;; Never quit at completion boundary
  (corfu-quit-no-match nil)      ;; Never quit, even if there is no match
  (corfu-preview-current t)      ;; Enable current candidate preview
  (corfu-preselect 'prompt)      ;; Preselect the prompt
  (corfu-on-exact-match nil)     ;; Configure handling of exact matches
  (corfu-popupinfo-mode t)
  (corfu-echo-documentation t)        ; Already use corfu-popupinfo
  ;; Enable Corfu only for certain modes. See also `global-corfu-modes'.
  ;; :hook ((prog-mode . corfu-mode)
  ;;        (shell-mode . corfu-mode)
  ;;        (eshell-mode . corfu-mode))

  ;; Use TAB for cycling, default is `corfu-complete'.
  ;; :bind
  ;; (:map corfu-map
  ;;       ("TAB" . corfu-next)
  ;;       ([tab] . corfu-next)
  ;;       ("S-TAB" . corfu-previous)
  ;;       ([backtab] . corfu-previous))

  :init
  ;; Recommended: Enable Corfu globally.  Recommended since many modes provide
  ;; Capfs and Dabbrev can be used globally (M-/).  See also the customization
  ;; variable `global-corfu-modes' to exclude certain modes.
  (global-corfu-mode)
  ;; Enable optional extension modes:
  (corfu-history-mode)
  (corfu-popupinfo-mode)
  :config
  ;; use tab to auto-complete instead of C-M-i
  (setq tab-always-indent 'complete)
  )


;; Completion for eshell
(add-hook 'eshell-mode-hook (lambda ()
                              (setq-local corfu-auto nil)
                              (corfu-mode)))
#+end_src
*** Dabbrev 

#+begin_src emacs-lisp
;; (use-package cape
(use-package dabbrev
  ;; :ensure t
  ;; :bind ("M-/" . dabbrev-expand)
  :bind (("M-/" . dabbrev-completion)
         ("C-M-/" . dabbrev-expand))
  :config 
  ;; (add-to-list 'dabbrev-ignored-buffer-regexps "\\` ")
  (add-to-list 'dabbrev-ignored-buffer-modes 'authinfo-mode)
  (add-to-list 'dabbrev-ignored-buffer-modes 'doc-view-mode)
  (add-to-list 'dabbrev-ignored-buffer-modes 'pdf-view-mode)
  (add-to-list 'dabbrev-ignored-buffer-modes 'tags-table-mode))
#+end_src

*** Cape
#+begin_src emacs-lisp
;; Add extensions
(use-package cape
  ;; Bind prefix keymap providing all Cape commands under a mnemonic key.
  ;; Press C-c p ? to for help.
  ;; :bind ("C-c p" . cape-prefix-map) ;; Alternative key: M-<tab>, M-p, M-+
  :bind ("M-p" . cape-prefix-map) ;; Alternative key: M-<tab>, M-p, M-+
  ;; Alternatively bind Cape commands individually.
  ;; :bind (("C-c p d" . cape-dabbrev)
  ;;        ("C-c p h" . cape-history)
  ;;        ("C-c p f" . cape-file)
  ;;        ...)
  :init
  ;; Add to the global default value of `completion-at-point-functions' which is
  ;; used by `completion-at-point'.  The order of the functions matters, the
  ;; first function returning a result wins.  Note that the list of buffer-local
  ;; completion functions takes precedence over the global list.
  (add-hook 'completion-at-point-functions #'cape-dabbrev)
  (add-hook 'completion-at-point-functions #'cape-file)
  (add-hook 'completion-at-point-functions #'cape-elisp-block)
  ;; (add-to-list 'completion-at-point-functions  #'cape-file #'cape-abbrev #'cape-dabbrev)
  ;; (add-hook 'completion-at-point-functions #'cape-history)
  ;; ...
)
#+end_src

*** COMMENT elisp-mode-cape
#+begin_src emacs-lisp
(use-package elisp-mode-cape
  :no-require t
  :after (cape elisp-mode)
  :hook (emacs-lisp-mode . my/setup-elisp)
  :preface
  (defun my/setup-elisp ()
    (setq-local completion-at-point-functions
                `(,(cape-capf-super
                    #'elisp-completion-at-point
                    #'cape-dabbrev)
                  cape-file)
                cape-dabbrev-min-length 2)))
#+end_src

*** Eglot with Corfu
#+begin_src emacs-lisp
;; Option 1: Specify explicitly to use Orderless for Eglot
(setq completion-category-overrides '((eglot (styles orderless))
                                      (eglot-capf (styles orderless))))

;; Enable cache busting, depending on if your server returns
;; sufficiently many candidates in the first place.
(advice-add 'eglot-completion-at-point :around #'cape-wrap-buster)
#+end_src

*** Company
Better AutoComplete using Company with LSP-Mode.  eglot (the built-in LSP but less mature&outdated)
#+begin_src emacs-lisp
(use-package company
  ;; for global company mode
  ;; :init (add-hook 'after-init-hook 'global-company-mode)
  ;; For company mode only in programming modes
  :after lsp-mode
  :hook (prog-mode . company-mode)
  :bind (:map company-active-map
	      ("<tab>" . comany-complete-selection))
        (:map lsp-mode-map
	      ("<tab>" . company-indent-or-complete-common))
  :custom
  (company-minimum-prefix-length 1)
  (company-idle-delay 0.0)
  :config
  (setq company-dabbrev-downcase 0)
  (setq company-idle-delay 0.1)
  (setq company-tooltip-align-annotations t)
  (setq company-minimum-prefix-length 1))

(use-package company-box
  :hook (company-mode . company-box-mode))

(with-eval-after-load 'company
  (define-key company-active-map (kbd "M-n") nil) ;; unset defaults
  (define-key company-active-map (kbd "M-p") nil) ;; unset defaults
  (define-key company-active-map (kbd "C-SPC") nil) ;; unset defaults
  (define-key company-active-map (kbd "C-SPC") #'company-complete)
  (define-key company-active-map (kbd "C-n") #'company-select-next)
  (define-key company-active-map (kbd "C-p") #'company-select-previous)
  (define-key company-active-map (kbd "SPC") #'company-abort))
#+end_src
*** COMMENT Show LSP-UI-Docs
#+begin_src emacs-lisp
(setq lsp-ui-doc-position 'bottom)
(setq lsp-ui-doc-enable t)
(setq lsp-ui-doc-show-with-mouse t)

(setq lsp-ui-peek-enable t)

(setq lsp-ui-sideline-enable t)
(setq lsp-ui-sideline-show-hover t)
(setq lsp-ui-sideline-show-code-actions t)
(setq lsp-ui-sideline-diagnostic-max-lines t)

(setq lsp-eldoc-enable-hover t)
#+end_src
** Directory Environments
replacing direnv
#+begin_src emacs-lisp
(use-package envrc
  :ensure t
  :hook (after-init . envrc-global-mode))
#+end_src

** Programming
*** Elisp
Elisp Company Backed
#+begin_src emacs-lisp
(use-package slime-company
  :ensure t
  :init
  (require 'company)
  :after (slime company)
  :config (setq slime-company-completion 'fuzzy
                slime-company-after-completion 'slime-company-just-one-space)
  (slime-setup '(slime-fancy slime-company)))

(add-hook 'emacs-lisp-mode-hook 'eldoc-mode)
(add-hook 'emacs-lisp-mode-hook 'yas-minor-mode)
(add-hook 'emacs-lisp-mode-hook 'company-mode)
#+end_src

*** COMMENT Test Python Pyright
#+begin_src elisp
  (use-package lsp-mode
    :hook ((
  	  ; c-mode          ; clangd
            ; c++-mode        ; clangd
            ; c-or-c++-mode   ; clangd
            ; java-mode       ; eclipse-jdtls
            js-mode         ; ts-ls (tsserver wrapper)
            ; js-jsx-mode     ; ts-ls (tsserver wrapper)
            ; typescript-mode ; ts-ls (tsserver wrapper)
            python-mode       ; pyright
            ; web-mode        ; ts-ls/HTML/CSS
            ; haskell-mode    ; haskell-language-server
            ) . lsp-deferred)
    :commands lsp
    :config
    (setq lsp-auto-guess-root t)
    ;; (setq lsp-log-io nil)
    (setq lsp-restart 'auto-restart)
    (setq lsp-enable-symbol-highlighting t)
    (setq lsp-enable-on-type-formatting t)
    (setq lsp-signature-auto-activate t)
    (setq lsp-signature-render-documentation t)
    (setq lsp-eldoc-hook t)
    (setq lsp-modeline-code-actions-enable t)
    ;; or (lsp-modeline-diagnostics-mode)
    (setq lsp-modeline-diagnostics-enable t)
    (setq lsp-headerline-breadcrumb-enable t)
    (setq lsp-semantic-tokens-enable t)
    (setq lsp-enable-folding t)
    (setq lsp-enable-imenu t)
    (setq lsp-enable-snippet t)
    (setq read-process-output-max (* 1024 1024)) ;; 1MB
    (setq lsp-idle-delay 0.5))



  (use-package lsp-ui
    :commands lsp-ui-mode
    :config
    ;; Jump to Definitions
    (setq lsp-ui-peek-enable t)
    (setq lsp-ui-peek-show-directory t)
    ;; (lsp-headerline-breadcrumb-mode)
    (setq lsp-headerline-breadcrumb-enable t)
    (setq lsp-headerline-breadcrumb-enable-diagnostics t)
    (setq lsp-headerline-breadcrumb-icons-enable t)
    ;; Show Docs on Hover
    (setq lsp-ui-doc-enable t)
    (setq lsp-ui-doc-header t)
    (setq lsp-ui-doc-include-signature t)
    (setq lsp-ui-doc-border (face-foreground 'default))
    ;; Show Code Actions on the side when cursor hovers
    (setq lsp-ui-sideline-show-code-actions t)
    (setq lsp-ui-sideline-show-hover t)
    (setq lsp-ui-sideline-delay 0.05)
    ;; Side Menu with imenu
    (setq lsp-ui-imenu-enable t)
    (setq lsp-ui-imenu-auto-refresh t))

  (use-package lsp-pyright
    :hook (python-mode . (lambda () (require 'lsp-pyright)))
    :init (when (executable-find "python")
            (setq lsp-pyright-python-executable-cmd "python")))
#+end_src
*** Python
ref: https://www.adventuresinwhy.com/post/eglot/
ref: emacs-from-scratch series

*Try Python with Pyright LSP (more stable???)*

prereq: *pip install --user "python-language-server[all]"*
sudo pacman -Syu python-language-server
sudo apt install python3-pylsp python3-jedi python3-flake8
sudo apt install python_
ensure *.local/bin* is in PATH
#+begin_src emacs-lisp
;; (use-package python-mode
  ;; :ensure t
  ;; :hook (python-mode . lsp-deferred)
  ;; :custom
  ;; NOTE: Set these if Python 3 is called "python3" on your system!
  ;; (python-shell-interpreter "python")
  ;; USE THIS IN LINUX INSTEAD???
  ;; (dap-python-executable "python3")
  ;; (dap-python-debugger 'debugpy)
  ;; :config
  ;;(require 'dap-python)
;; )

;; Open python files in tree-sitter mode.
(add-to-list 'major-mode-remap-alist '(python-mode . python-ts-mode))
(use-package pyvenv
  ;; :ensure t
  ;; only in Python-Mode
  :after python-mode
  :config
  (pyvenv-mode t))
#+end_src
**** Debugging
#+begin_src emacs-lisp
;; (use-package dap-mode
;;   ;; Uncomment the config below if you want all UI panes to be hidden by default!
;;   :custom
;;   (lsp-enable-dap-auto-configure nil)
;;   :config
;;   (dap-ui-mode 1)
;;   :commands dap-debug
;;   :config
;;   ;; Set up Node debugging
;;   (require 'dap-node)
;;   (dap-node-setup) ;; Automatically installs Node debug adapter if needed

;;   ;; Bind `C-c l d` to `dap-hydra` for easy access
;;   (general-define-key
;;     :keymaps 'lsp-mode-map
;;     :prefix lsp-keymap-prefix
;;     "d" '(dap-hydra t :wk "debugger")))
#+end_src
*** COMMENT JavaScript
Need Nodejs > v20
ref:
  - https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-22-04
  - https://nodesource.com/products/distributions

then just apt install nodejs (includes the latest npm)
#+begin_src emacs-lisp
(use-package add-node-modules-path
  :defer t
  :hook (((js2-mode rjsx-mode) . add-node-modules-path)))

;; (eval-after-load 'js-mode
;;   '(add-hook 'js-mode-hook #'add-node-modules-path))

;; (eval-after-load 'js2-mode
;;   '(add-hook 'js2-mode-hook #'add-node-modules-path))
#+end_src

*** C/C++
need to decide on using clangd or ccls
#+begin_src emacs-lisp
;; using ccl;; s
;; (use-package ccls
;;     :hook ((c-mode c++-mode cuda-mode) .
;;   	     (lambda () (require 'ccls) (lsp))))
;; (setq ccls-executable "/usr/bin/ccls")
;; (setq ccls-use-default-rainbow-sem-highlight 'font-lock)
;; (ccls-code-lens-mode 1)

;; (with-eval-after-load 'company
;;   (add-hook 'c++-mode-hook 'company-mode)
;;   (add-hook 'c-mode-hook 'company-mode))

;; (use-package company-c-headers
;;   :ensure t)
#+end_src

**** vscode settings.json
#+begin_center
"C_Cpp.default.includePath": [
        "...\\Python\\Python310\\include"
 ]

"configurations": [
    {

      "inheritEnvironments": [
        "mingw_64"
      ],
      "name": "Mingw64",
      "includePath ,": [
        "${env.INCLUDE}",
        "${workspaceRoot}\\**",
      ],
      "intelliSenseMode": "linux-gcc-x64",
      "environments": [
        {
          "MINGW64_ROOT": "C:\\msys64\\mingw64",
          "BIN_ROOT": "${env.MINGW64_ROOT}\\bin",
          "FLAVOR": "x86_64-w64-mingw32",
          "TOOLSET_VERSION": "9.1.0",
          "PATH": "${env.MINGW64_ROOT}\\bin;${env.MINGW64_ROOT}\\..\\usr\\local\\bin;${env.MINGW64_ROOT}\\..\\usr\\bin;${env.MINGW64_ROOT}\\..\\bin;${env.PATH}",
          "INCLUDE": "${env.MINGW64_ROOT}\\include\\c++\\${env.TOOLSET_VERSION};${env.MINGW64_ROOT}\\include\\c++\\${env.TOOLSET_VERSION}\\tr1;${env.MINGW64_ROOT}\\include\\c++\\${env.TOOLSET_VERSION}\\${env.FLAVOR};",
          "environment": "mingw_64"
        }
      ]
    }
  ]
#+end_center

#+begin_center
{
  "env": {
    "myIncludePath": ["${workspaceFolder}/include", "${workspaceFolder}/src"],
    "myDefines": ["DEBUG", "MY_FEATURE=1"]
  },
  "configurations": [
    {
      "name": "Mac",
      "compilerPath": "/usr/bin/clang++",
      "intelliSenseMode": "macos-clang-x64",
      "includePath": ["${myIncludePath}", "${workspaceFolder}/**"],
      "defines": ["${myDefines}"],
      "cStandard": "c17",
      "cppStandard": "c++20",
      "macFrameworkPath": ["/System/Library/Frameworks", "/Library/Frameworks"],
      "browse": {
        "path": ["${myIncludePath}", "${workspaceFolder}"]
      }
    }
  ],
  "version": 4,
  "enableConfigurationSquiggles": true
}

#+end_center
*** Rust
#+begin_src emacs-lisp
;; (use-package toml-mode)
;; (use-package rust-mode
;;   :hook (rust-mode . lsp))
#+end_src
*** Julia
#+begin_src emacs-lisp
(use-package julia-mode
  :ensure t)

(use-package julia-ts-mode
  :ensure t
  :mode "\\.jl$")

(use-package julia-vterm
  :defer t
  :init
  ;; Limit Julia to use only 4 Threads
  (setq julia-vterm-repl-program "~/.cargo/bin/julia -t 4")
  ;; (add-hook 'julia-mode-hook #'julia-vterm-mode)
  ;; equivalent shortform
  :hook (julia-mode . julia-vterm-mode))

;; ob-julia-vterm
;; Prereq: julia-vterm
(use-package ob-julia-vterm
  :after org)

(use-package eglot-jl)
;; after installation M-x `eglot-jl-init`
;; will load support, but will take a while to compile
#+end_src
** Minimap
show & navigate whole buffer
ref: https://github.com/emacsmirror/demap
M-x demap-open / demap-toggle
#+begin_src emacs-lisp
  (use-package demap
    :ensure t
    :config
   (setq demap-minimap-window-width 15)
   (setq demap-minimap-window-side  'right))
#+end_src
** IMenu
- to show overview of symbols in the buffer

#+begin_src elisp
(use-package imenu-list
  :ensure t
  :bind
  ("M-g i" . imenu-list-smart-toggle))
#+end_src


** Version Control
*** Magit
#+begin_src emacs-lisp
(use-package diff-hl
:ensure t 
:config (global-diff-hl-mode))

(add-hook 'magit-post-refresh-hook 'diff-hl-magit-post-refresh)
#+end_src
*** Blame
#+begin_src emacs-lisp
(use-package blamer
  :after magit
  :bind (("C-c g i" . blamer-show-commit-info)
         ("C-c g b" . blamer-show-posframe-commit-info))
  :defer 20
  :custom
  (blamer-idle-time                 0.3)
  (blamer-min-offset                4)
  (blamer-max-commit-message-length 100)
  (blamer-datetime-formatter        "[%s]")
  (blamer-commit-formatter          " ? %s")
  :custom-face
  (blamer-face ((t :foreground "#7aa2cf"
                    :background nil
                    :height 1
                    :italic nil))))
#+end_src

*** git-gutter
ref: https://ianyepan.github.io/posts/emacs-git-gutter/
#+begin_src emacs-lisp
(use-package git-gutter
  :ensure t
  :hook (prog-mode . git-gutter-mode)
  :config
  ;; update every 1 second
  (setq git-gutter:update-interval 1))

(use-package git-gutter-fringe
  :ensure t
  :config
  (define-fringe-bitmap 'git-gutter-fr:added [224] nil nil '(center repeated))
  (define-fringe-bitmap 'git-gutter-fr:modified [224] nil nil '(center repeated))
  (define-fringe-bitmap 'git-gutter-fr:deleted [128 192 224 240] nil nil 'bottom))

;; (use-package git-lens
;;   ;; :ensure t
;;   :after git-gutter-mode)
#+end_src
** Diagramming
Show Diagrams using Mermaid
#+begin_src emacs-lisp
  (use-package mermaid-mode
    :after org)
  (use-package ob-mermaid
    :after org)

  (setq ob-mermaid-cli-path "mmdc")
#+end_src
* LaTeX
#+begin_src emacs-lisp
(use-package auctex
  :ensure t
  :hook
  (LaTeX-mode . turn-on-prettify-symbols-mode)
  (LaTeX-mode . turn-on-flyspell))
#+end_src
* YASnippet
- currently only enable for programming modes
- C-c C-s: inserts snippet
#+begin_src emacs-lisp
(use-package yasnippet
  :ensure t
  :config
  (yas-reload-all)
  (add-hook 'prog-mode-hook 'yas-minor-mode)
  (add-hook 'text-mode-hook 'yas-minor-mode)
)
(setq yas-snippet-dirs
      '("~/.emacs.d/snippets"                 ;; personal snippets
       ;; "/path/to/some/collection/"           ;; foo-mode and bar-mode snippet collection
       ;; "/path/to/yasnippet/yasmate/snippets" ;; the yasmate collection
        ))
;;(yas-global-mode t)
#+end_src

* Improved Org-Mode
- use *org-preview-html-mode* to view org file in html mode
** Org-Mode.el
#+begin_src emacs-lisp
;; Faces
(set-face-attribute 'org-document-info nil :height 1.2)
(set-face-attribute 'org-document-title nil :height 1.3)
(set-face-attribute 'org-level-1 nil :extend nil :weight 'bold :height 1.15)
(set-face-attribute 'org-level-2 nil :extend nil :weight 'normal :height 1.1)
(set-face-attribute 'org-level-3 nil :extend nil :height 1.05)

;; ref: https://sachachua.com/blog/2024/10/change-org-mode-todo-keyword-color-based-on-the-state-and-the-current-modus-theme/
(setq org-todo-keywords
      '((sequence
         ;; Needs further action
	 "TODO(t)" "DOING(p)" "WAITING(w)" "CANCELLED(x)"
	 "|"
         ;; Needs no action currently
	 "IMPROVEMENT(i)" "SOMEDAY(s)"  "DONE(d)")))

(setq org-todo-keyword-faces
      `(("TODO" . (:foreground "red" :weight bold))
        ("WAITING" . (:foreground "pink" :weight bold))
        ("CANCELLED" . (:foreground "orange" :weight bold))
        ("DOING" . (:foreground "yellow" :weight bold))
        ("IMPROVEMENT" . (:foreground "blue" :weight bold))
        ("SOMEDAY" . (:foreground "brown" :weight bold))
        ("DONE" . (:foreground "green" :weight bold))))
#+end_src

** Org-Bullet
#+begin_src emacs-lisp
(use-package org-bullets
  :ensure t
  :defer t
  :config
  (add-hook 'org-mode-hook (lambda () (org-bullets-mode t))))

;; add line wraps when in org-mode
(add-hook 'org-mode-hook '(lambda () (visual-line-mode t)))



(setq org-ellipsis "....")
(setq org-src-fontify-natively t)
(setq org-src-tab-acts-natively t)
(setq org-export-with-smart-quotes t)
(setq org-src-window-setup 'current-window)
(add-hook
 'org-mode-hook
 'org-indent-mode
 ;; add line wraps when in org-mode
 '(lambda () (visual-line-mode t))

 )

;; Disable Shift Highlight in Org Mode
(setq org-support-shift-select nil)
;; When editing source block mode, use language indentation
(setq org-src-preserve-indentation t)

(require 'ob-C)
(require 'ob-duckdb)
(require 'ob-makefile)

;; Active Babel Language Executions in Org Mode
(org-babel-do-load-languages
 'org-babel-load-languages
 '(
   ;; (mmdc . t)                    ;; (not needed) for mermaid diagrams
   ;; (dsq . t)                     ;; for use with ob-dsq for querying JSON, parquet etc..
   (duckdb . t)		     ;; replacing dsq
   (dot . t)                     ;; for DOT graphs
   (gnuplot . t)
   (makefile . t)                ;; just for syntax highlight, cannot babel run, need tangle 
                                 ;; then run from the tangle file if want test it
   (shell . t)                   ;; enable a shell, regardless bash, fish etc...
   (C . t)
   (python . t)
   (js . t)
   (latex . t)
   (julia-vterm . t)
   ))

(setq org-babel-python-command "/usr/bin/python3")

;; Use `julia` as the source block name instead of julia-vterm
(defalias 'org-babel-execute:julia 'org-babel-execute:julia-vterm)
(defalias 'org-babel-variable-assignments:julia 'org-babel-variable-assignments:julia-vterm)

;; Don't ask for every code block to execute
(setq org-confirm-babel-evaluate nil)
;; to display inline graphviz in org-mode
(add-hook 'org-babel-after-execute-hook 'org-redisplay-inline-images)

;; to add items in general like lists and headers
(with-eval-after-load 'org
  (define-key org-mode-map (kbd "C-S-<return>") #'org-insert-item))
#+end_src


** corg
Completion for org source block headers

C-M-i : to trigger auto-complete
#+begin_src emacs-lisp
(use-package corg
  :vc (:url "https://github.com/isamert/corg.el")
  ;; :hook (org-mode . corg-setup)
)

(add-hook 'org-mode-hook #'corg-setup)
#+end_src

** Org-Mode Babel Async
Enables several async code blocks, may interfere with blocks that define the :async
#+begin_src emacs-lisp
(use-package ob-async
  :commands org-babel-execute-src-block:async)
#+end_src

** Org-Mode HTML Export
#+begin_src emacs-lisp
(use-package org-preview-html
  :ensure t
  :defer t)
;; :config
;; (add-hook 'org-mode-hook )
;;)

;; Syntax highlighting for documents exported to HTML
(use-package htmlize
  :ensure t)
#+end_src

** Focus
Focus On a SubHeader segment, run focus-mode
#+begin_src emacs-lisp
(use-package focus)
#+end_src
** Markdown Mode
ref: https://github.com/jamescherti/minimal-emacs.d?tab=readme-ov-file#configuring-markdown-mode-eg-readmemd-syntax
It supports core Markdown syntax as well as extensions like GitHub Flavored Markdown (GFM).

ref: https://jblevins.org/projects/markdown-mode/

#+begin_src emacs-lisp
(use-package markdown-mode
  :commands (gfm-mode
             gfm-view-mode
             markdown-mode
             markdown-view-mode)
  :mode (("\\.markdown\\'" . markdown-mode)
         ("\\.md\\'" . markdown-mode)
         ("README\\.md\\'" . gfm-mode))
  ;; :init
  ;; (setq markdown-command "multimarkdown")
  :config
  ;; Set custom markdown preview function
  (setq markdown-live-preview-window-function #'my-markdown-preview-function)
  ;; always open the preview window at the right
  (setq markdown-split-window-direction 'right)
  ;; always open the preview window at the bottom
  (setq markdown-split-window-direction 'below)
  ;; delete exported HTML file after markdown-live-preview-export is called
  (setq markdown-live-preview-delete-export 'delete-on-export)
  :bind
  ;; make bindings similiar to org-mode
  (:map markdown-mode-map
	("<M-right>" . markdown-demote)
	("<M-left>" . markdown-promote)
	("<M-up>" . markdown-move-up)
	("<M-down>" . markdown-move-down)
	("<C-return>" . markdown-insert-header-dwim)
        ("C-c C-e" . markdown-do)))


;; Customize convert org-md-convert-region-to-md;; Disable TOC, subscripts etc...

#+end_src
** COMMENT Org-Modern
For aesthetics?
- Disable for now bcoz not all icons load properly, especially H3?
#+begin_src emacs-lisp
;; (use-package org-modern
;;   :ensure t)
;; (with-eval-after-load 'org (global-org-modern-mode))
#+end_src

** Disable Electric Indent
fix some of the weird indents in org mode
#+begin_src emacs-lisp
(electric-indent-mode -1)
(setq org-edit-src-content-indentation 0)
#+end_src

** Org-Roam
- testing out org-roam
- requires graphviz DOT executable `apt install graphviz`

#+begin_src emacs-lisp
  (use-package org-roam
    :ensure t
    :custom
    (org-roam-directory (file-truename "~/notes/org-roam-notes/"))
    ;; (setq org-roam-db-location "~/.emacs.d/org-roam.db")
    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("C-c n f" . org-roam-node-find)
           ("C-c n g" . org-roam-graph)
           ("C-c n i" . org-roam-node-insert)
           ("C-c n c" . org-roam-capture)
           ;; Dailies
           ("C-c n j" . org-roam-dailies-capture-today))
    :config  ;; If you're using a vertical completion framework, you might want a more informative completion interface
    (setq org-roam-node-display-template
  	(concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))
    (org-roam-db-autosync-mode)
    ;; Org Roam Improvements
    ;; ref: https://www.orgroam.com/manual.html#Garbage-Collection
    ;; export with references to links in org-roam.db
    (require 'org-roam-export)
    (setq org-roam-db-gc-threshold most-positive-fixnum)
    ;; If using org-roam-protocol
    (require 'org-roam-protocol))
#+end_src

** Org-Roam-UI
#+begin_src emacs-lisp
(use-package websocket
  :after org-roam)

(use-package org-roam-ui
  :after org-roam
  :config
  (setq org-roam-ui-sync-theme t
          org-roam-ui-follow t
          org-roam-ui-update-on-save t
          org-roam-ui-open-on-start t))
(add-to-list 'load-path "~/notes/org-roam-notes/")
;; (load-library "org-roam-notes")
#+end_src

** Org-Agenda
current_task.org to specify current schedules
#+begin_src emacs-lisp
(setq org-directory (file-truename "~/notes/org-roam-notes/"))
(setq org-agenda-files (list "~/notes/org-roam-notes/current_task.org"))
#+end_src

** COMMENT Org-dsq
To read SQL, json, csv, parquet etc...

Not maintained anymore, should look into DuckDB
#+begin_src emacs-lisp
;; (use-package ob-dsq :ensure t)
#+end_src

** Ob-DuckDB
#+begin_src emacs-lisp

#+end_src

* Custom Utils
** Org to Word Docx Export
need pandoc & ox-pandoc
#+begin_src elisp
(use-package ox-pandoc
  :ensure t)
#+end_src
** COMMENT Org to Word Docx Custom Function
#+begin_src elisp
(defun my_fun/office-export ()
  "Export Org file to ODT with a user-selected template using nice names."
  (interactive)
  ;; Ask if we should keep line breaks
  (let* ((preserve-line-breaks (y-or-n-p "Do you want to preserve line breaks? "))
         ;; Ask if we should export just the body (no header, footer, title, or author)
         (body-only (y-or-n-p "Body only?"))
         (templates '(("Template 1" . "~/notes/templates/template1.ott")
                      ("Template 2" . "~/notes/templates/template2.ott")
                        ("Template 3" . "~/notes/templates/template3.ott")))
         (nice-name (completing-read "Choose ODT template: " (mapcar 'car templates)))
         (template-path (cdr (assoc nice-name templates))))

    ;; Use `let` to locally bind export options
    (let ((org-export-preserve-breaks preserve-line-breaks)
          (org-export-with-toc (not body-only))
          (org-export-with-title (not body-only))
          (org-export-with-author (not body-only))
          (org-odt-styles-file template-path))

      ;; Export the current Org buffer to ODT
      (org-odt-export-to-odt))))
#+end_src
** COMMENT CSV_Rainbow
ref: https://github.com/emacs-vs/rainbow-csv?tab=readme-ov-file

#+begin_src emacs-lisp
(add-hook 'csv-mode-hook #'rainbow-csv-mode)
(add-hook 'tsv-mode-hook #'rainbow-csv-mode)
#+end_src
** Path Autocomplete
https://github.com/emacs-vs/company-paths
#+begin_src emacs-lisp

#+end_src
** COMMENT MediaWiki

Temp just use wikiman in Arch

mainly for arch wiki
#+begin_src emacs-lisp
(require 'mediawiki)
(add-to-list 'load-path "~/tools/arch-wiki-docs/usr/share/doc/arch-wiki/")
(add-to-list 'load-path "~/tools/arch-wiki-docs/usr/share/doc/arch-wiki/html/en")
#+end_src
** COMMENT (Doesn't work on WSL) Copy Org Mode Styling to Clipboard
Needs `htmlize`, use `htmlize-region-for-paste`

#+begin_example
    M-x highlight2clipboard-copy-region-to-clipboard RET -- Copy the region, with formatting, to the clipboard.

    M-x highlight2clipboard-copy-buffer-to-clipboard RET -- Copy the buffer, with formatting, to the clipboard.

    Highlight2clipboard mode -- Global minor mode, when enabled, all copies and cuts are exported, with formatting information, to the clipboard.
#+end_example

#+begin_src emacs-lisp
;; Only Works on Mac & MS-DOS
;; (load "highlight2clipboard.el")

;; ref: https://stackoverflow.com/questions/22024765/how-to-copy-paste-without-source-font-lock-in-emacs
; Source - https://stackoverflow.com/a
; Posted by Rudolf Adamkovič
; Retrieved 2025-11-12, License - CC BY-SA 4.0
;; (setq yank-excluded-properties t)
#+end_src
* Emacs Utils
*M-x*:
- *dired*: file explorer
** Helpful Messages
#+begin_src emacs-lisp
;; (use-package helpful
;;   :ensure t
;;   :bind (:map custom-bindings-map
;; 			  ("C-h f" . #'helpful-function)
;; 			  ("C-h v" . #'helpful-variable)
;; 			  ("C-h k" . #'helpful-key)
;; 			  ("C-h x" . #'helpful-command)
;; 			  ("C-h d" . #'helpful-at-point)
;; 			  ("C-h c" . #'helpful-callable)))
#+end_src
** Docker Utils
#+begin_src emacs-lisp
(use-package docker
  :commands docker)
#+end_src
** COMMENT RSS Reader (For Linux Only)
#+begin_src emacs-lisp
(use-package elfeed
  :bind (:map custom-bindings-map ("C-x w" . elfeed))
  :config
  (setq elfeed-feeds
      '("http://nullprogram.com/feed/"
        "https://planet.emacslife.com/atom.xml"
        "https://deniskyashif.com/index.xml"
        "https://sophiebos.io/index.xml")))
#+end_src
** PDF Utils
*** PDF Tools (Linux Only)
need install Cask & pdf-info first
#+begin_src emacs-lisp
(use-package pdf-tools
  :defer t
  :init (pdf-loader-install)
  :hook ((pdf-view-mode . (lambda () (display-line-numbers-mode -1)))
	 (pdf-view-mode . (lambda () (auto-revert-mode -1)))
         (pdf-view-mode . (lambda () (company-mode -1))))
  :bind (:map pdf-view-mode-map
              ("C-s"   . isearch-forward)
              ("C-M-s" . pdf-occur)))
(pdf-tools-install)  ; Standard activation command
(pdf-loader-install) ; On demand loading, leads to faster startup time
#+end_src

** Useful Packages
*** TLDR Client
Needs unzip
M-x package-install tldr
tldr-update-docs
#+begin_src emacs-lisp
(use-package tldr
  :ensure t)
#+end_src
tldr
(TLDR-Mode) (SPC: search TLDR Docs)
*** Browse Kill-Ring
- browse your copyboard?
#+begin_src emacs-lisp
(use-package browse-kill-ring
  :commands browse-kill-ring)
;unbound from next
(global-unset-key (kbd "C-v"))
(global-set-key (kbd "C-v") 'browse-kill-ring)

#+end_src

*** Clear Kill Ring
#+begin_src emacs-lisp
(defun my/clear-kill-ring ()   
  "Clear the results on the kill ring."
  (interactive)
  (setq kill-ring nil))

(defun my/mark-line (&optional arg)
  "Mark the current line, or ARG lines."
  (interactive "P")
  (if (null arg)
      (progn
        (set-mark (line-beginning-position))
        (forward-line 1))
    ;; With argument, mark ARG lines
    (let ((count (prefix-numeric-value arg)))
      (set-mark (line-beginning-position))
      (forward-line count))))
(global-set-key (kbd "C-l") 'my/mark-line)
;; Overrides recenter-top-bottom

#+end_src
*** Browse Web Browser

#+begin_src emacs-lisp
(use-package browse-url
  :defer t
  :custom
  ;; LINUX
  (browse-url-browser-function 'browse-url-generic browse-url-generic-program "icecat")
  ;; MS-DOS
  ;;(browse-url-browser-function 'browse-url-default-windows-browser)
)
#+end_src

ref: https://stackoverflow.com/questions/4506249/how-can-i-make-emacs-org-mode-open-links-to-sites-in-google-chrome
**** COMMENT Windows
You don't mention your OS, but if it's Windows or Mac, you can try:
#+begin_src emacs-lisp
(setq browse-url-browser-function 'browse-url-default-windows-browser)
#+end_src

**** COMMENT Linux
#+begin_src emacs-lisp
(setq browse-url-browser-function 'browse-url-generic
      ;; browse-url-generic-program "chromium-browser"
      browse-url-generic-program "icecat"
)
#+end_src
*** REST Client
**** Verb
remember install verb

C-c C-q (org-set-tags-command) for headers to test
Verb CMD  C-s (verb-send-request-on-point-other-window: send req in other window)
#+begin_src emacs-lisp
(use-package verb
  :after org
  :config (define-key org-mode-map (kbd "C-c C-v") verb-command-map))

;; (with-eval-after-load 'org
;;   (define-key org-mode-map (kbd "C-c C-r") verb-command-map))

;; Verb Cmds
;; C-r : send req in new buffer ; send-res-to-other-window-stay
;; C-e : send req in new buffer

;; (use-package org
;;   :mode ("\\.org\\'" . org-mode)
;;   :config (define-key org-mode-map (kbd "C-c C-r") verb-command-map))
#+end_src
***** Testing Verb                                                 :verb:
get https://reqres.in/api/users



#+begin_src emacs-lisp
(use-package restclient
  :mode ("\\.rest\\'" . restclient-mode))
#+end_src

*** Visual Undo (Vundo)
Show the undo tree
#+begin_src emacs-lisp
(use-package vundo
  :bind (("C-c C-/" . vundo)))
#+end_src
*** Man / Woman (For Windows) Pages

*** COMMENT Swagger/OpenAPI Client
Still experimenting

https://github.com/isamert/swagg.el
#+begin_src emacs-lisp
(use-package swagg
  :ensure t
  :vc (:url "https://github.com/isamert/swagg.el")
  ;; :hook (org-mode . corg-setup)
)

(setq
 swagg-definitions
 '((:name "GitHub"
    :json "https://raw.githubusercontent.com/github/rest-api-description/main/descriptions/api.github.com/api.github.com.json"
    :base "https://api.github.com"
    :header-all ((token . "12345")
                 (Cache-Control . "no-cache")
                 (Content-Type . "application/json")
                 (Accept . "application/json")
                 (another-header . "value")))
   ;; (:name "GitLab"
   ;;  :yaml "https://gitlab.com/gitlab-org/gitlab/-/raw/master/doc/api/openapi/openapi.yaml"
   ;;  :base "https://gitlab.com/api"
   ;;  :header ((token . "12345")
   ;;           (Cache-Control . "no-cache")
   ;;           (Content-Type . "application/json")
   ;;           (Accept . "application/json")
   ;;           (another-header . "value")))
   (:name "py-service-engine"
    ;;:yaml "https://gitlab.com/gitlab-org/gitlab/-/raw/master/doc/api/openapi/openapi.yaml"
    :json "http://localhost:8004/openapi.json"
    :base "http://localhost:8004/"
    :header ((Content-Type . "application/json")
             (Cache-Control . "no-cache")
             (Accept . "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8")
             (Accept-Encoding . "gzip, deflate, br, zstd")
             (another-header . "value"))
    )
))

#+end_src

* UNIX Utils
*M-x*:
- *proced* : view unix processes (can view PID & kill processes)
* Modeline
Clearning up modeline by diminishing minor modes
#+begin_src emacs-lisp
  ;; (use-package spaceline
  ;;   :ensure t
  ;;   :config
  ;;   (require 'spaceline-config)
  ;;     (setq spaceline-buffer-encoding-abbrev-p nil)
  ;;     (setq spaceline-line-column-p nil)
  ;;     (setq spaceline-line-p nil)
  ;;     (setq powerline-default-separator (quote arrow))
  ;;     (spaceline-spacemacs-theme))

  (use-package doom-modeline
    :init (doom-modeline-mode)
    :custom
    (doom-modeline-minor-modes t)
    (doom-modeline-major-mode-icon t)
    (doom-modeline-enable-word-count t)
    (doom-modeline-height 30)
    (doom-modeline-bar-width 5)
    (doom-modeline-indent-info t)
    (doom-modeline-lsp t)
    (doom-modeline-github t)
    (doom-modeline-buffer-modification-icon t)
    (doom-modeline-unicode-fallback t)
    (doom-modeline-icon (display-graphic-p))
    (doom-modeline-mu4e t))


  ;; Hide unimportant Minor Modes in Modeline
  (use-package diminish
    :ensure t
    :init
    (diminish 'yas-minor-mode)
    (diminish 'indent-guide-mode)
    (diminish 'git-gutter-mode)
    ; (diminish 'flycheck-mode)
    ; (diminish 'helm-mode)
    ; (diminish 'irony-mode)
    ; (diminish 'linum-relative-mode)
    ; (diminish 'hungry-delete-mode)
    ; (diminish 'visual-line-mode)
    ; (diminish 'subword-mode)
    ; (diminish 'page-break-lines-mode)
    ; (diminish 'auto-revert-mode)
    (diminish 'eldoc-box-hover-mode)
    (diminish 'all-the-icons-dired-mode)
    (diminish 'dired-async-mode)
    (diminish 'beacon-mode)
    (diminish 'highlight-indent-guides-mode)
    (diminish 'which-key-mode)
    (diminish 'whitespace-mode)
    (diminish 'global-whitespace-newline-mode)
    (diminish 'rainbow-delimiters-mode)
    (diminish 'rainbow-mode))

;; show clock
  (display-time-mode t)
;; (setq display-time-24hr-format t)
;; (setq display-time-format "%H:%M")
#+end_src

* Header Line

** Org-Mode Header Breadcrumbs

ref: https://emacs.stackexchange.com/questions/61101/keep-displaying-current-org-heading-info-in-some-way
*** COMMENT self defined
#+begin_src emacs-lisp
(defun my/heading-title ()
   "Get the heading title."
   (save-excursion
     (if (not (org-at-heading-p))
       (org-previous-visible-heading 1))
     (org-element-property :title (org-element-at-point))))

(defun my/org-breadcrumbs ()
   "Get the chain of headings from the top level down
    to the current heading."
   (let ((breadcrumbs (org-format-outline-path
                         (org-get-outline-path)
                         (1- (frame-width))
                         nil ">"))
         (title (my/heading-title)))
     (if (string-empty-p breadcrumbs)
         title
       (format "%s->%s" breadcrumbs title))))

(defun my/set-header-line-format()
  ;; display something in the header-line
  (setq header-line-format '(:eval (my/org-breadcrumbs))))

(add-hook 'org-mode-hook #'my/set-header-line-format)
#+end_src
*** breadcrumb package
#+begin_src emacs-lisp
(use-package breadcrumb
  :ensure t
  :hook (find-file-hook . breadcrumb-local-mode)
  :config
  (setq breadcrumb-imenu-max-length 1.0)
  (setq breadcrumb-project-max-length 1.0)

  ;; Make Org heading style the same.
  ;; https://github.com/joaotavora/breadcrumb/issues/35
  (defun breadcrumb-org-crumbs ()
    "Get the chain from the top level heading down to current heading."
    (unless (org-before-first-heading-p)
      (org-format-outline-path (org-get-outline-path t)
                               (1- (frame-width)) ; width
                               nil                ; prefix
                               "->")))           ; separator

  (define-advice breadcrumb--header-line
    (:override (&rest args) support-org-mode)
    "Helper for `breadcrumb-headerline-mode'."
    (let* ((imenu-crumbs (if (derived-mode-p 'org-mode)
                             'breadcrumb-org-crumbs
                           'breadcrumb-imenu-crumbs))
           (x (cl-remove-if
               #'seq-empty-p (mapcar #'funcall
                                     `(breadcrumb-project-crumbs ,imenu-crumbs)))))
      (mapconcat #'identity x (propertize ": " 'face 'breadcrumb-face)))))
#+end_src
* Untested Utils
** COMMENT LLMs
ref: https://gitlab.com/vslavkin/emacs-config/-/blob/master/emacs.org

#+begin_src emacs-lisp
(use-package gptel
  :commands (gptel gptel-menu)
  :bind ("C-c g" . gptel-menu)
  :custom
  (gptel-default-mode 'org-mode)
  :config
  (gptel-make-ollama "Ollama"             ;Any name of your choosing
    :host "localhost:11434"               ;Where it's running
    :stream t                             ;Stream responses
    :models '(deepseek-r1:14b qwen2.5:latest gemma2:latest phi4:latest)) ;List of models

  (gptel-make-gemini "Gemini"
    :key gemini-key
    :stream t
    :request-params '(:tools [(:google_search ())]))
  )
#+end_src
** COMMENT exec path from shell
load environ variables into shells
#+begin_src emacs-lisp

;; (require 'exec-path-from-shell) ;; if not using the ELPA package
(use-package exec-path-from-shell
  :ensure t)
(exec-path-from-shell-initialize)
#+end_src
** COMMENT Python-ts-mode fonts
ref: https://amitp.blogspot.com/2025/02/emacs-tree-sitter-custom-highlighting.html
#+begin_src emacs-lisp
(treesit-font-lock-rules
 :language 'python
 :feature 'definition
 :override t
 '(
   ((import_statement name: (dotted_name (identifier) @font-lock-variable-name-face)))
   ((import_from_statement module_name: (dotted_name (identifier))
                           name: (dotted_name (identifier) @font-lock-variable-name-face)))
   ))

(defvar amitp/python-treesit-settings
  (treesit-font-lock-rules
   :language 'python
   :feature 'keyword :override t
   '(
     (["assert" "await" "break" "continue" "finally" "raise" "return" "yield"] @amitp-control-keyword-face)
     (["type"] @font-lock-keyword-face)
    )))

(add-hook 'python-ts-mode-hook
          (lambda ()
            (setq-local treesit-font-lock-settings
                        (append treesit-font-lock-settings amitp/python-treesit-settings))))

(defface my-control-keyword-face)
(defvar my/python-treesit-settings
  ;; (treesit-font-lock-rules
  ;;  :language 'python
  ;;  :feature 'keyword
  ;;  :override t
  ;;  '(
  ;;    (["assert" "await" "break" "continue" "finally" "raise" "return" "yield"]
  ;;     @my-control-keyword-face)
  ;;    (["type"] @font-lock-keyword-face)
  ;;    )
  ;;  )
  (treesit-font-lock-rules
   :language 'python
   :feature 'definition
   :override t
   '(
     ((import_statement name: (dotted_name (identifier) @font-lock-variable-name-face)))
     ((import_from_statement module_name: (dotted_name (identifier))
                             name: (dotted_name (identifier) @font-lock-variable-name-face)))
     ))

)

(add-hook 'python-ts-mode-hook
          (lambda ()
            (setq-local treesit-font-lock-settings
                        (append treesit-font-lock-settings
                                my/python-treesit-settings))))

(add-hook 'python-mode-hook
  (lambda ()
    (add-function :before-until (local 'tree-sitter-hl-face-mapping-function)
      (lambda (capture-name)
	(pcase capture-name
	  ("doc" 'font-lock-comment-face))))))
#+end_src
** javascript-ts-mode fonts
#+begin_src emacs-lisp
(treesit-font-lock-rules
 :language 'javascript
 :feature 'constant
 :override t
 '((true) @font-lock-constant-face
   (false) @font-lock-constant-face)
 :language 'html
 :feature 'script
 "(script_element) @font-lock-builtin-face")
#+end_src
** COMMENT trees-sitter doc
#+begin_src emacs-lisp
(require 'tree-sitter)
(require 'tree-sitter-hl)
(require 'tree-sitter-langs)
(require 'tree-sitter-debug)
(require 'tree-sitter-query)

(global-tree-sitter-mode)
(add-hook 'tree-sitter-after-on-hook #'tree-sitter-hl-mode)
;; (tree-sitter-require 'rust)
(tree-sitter-require 'python)
;; Rust
(function_item (identifier) @func)
(impl_item (type_identifier) @impl)

;; Python
(class_definition (identifier) @class)
(function_definition (identifier) @func)

;; Javascript
(function_declaration (identifier) @func)
(variable_declarator (identifier) @var)

;; (mapc #'treesit-install-language-grammar (mapcar #'car treesit-language-source-alist))
(treesit-language-available-p 'python)	;Check treesitter for language available
(treesit-language-available-p 'c)	;Check treesitter for language available
(treesit-language-available-p 'c++)	;Check treesitter for language available
(setq major-mode-remap-alist
 '((yaml-mode . yaml-ts-mode)
   (bash-mode . bash-ts-mode)
   (js2-mode . js-ts-mode)
   (typescript-mode . typescript-ts-mode)
   (json-mode . json-ts-mode)
   (css-mode . css-ts-mode)
   (python-mode . python-ts-mode)))
#+end_src
